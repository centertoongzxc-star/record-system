<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ระบบบันทึกข้อมูลกำลังพล</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f4f4f4;
    }
    .form-box {
        background: white;
        padding: 15px;
        border-radius: 10px;
        width: 350px;
        margin-bottom: 20px;
    }
    table {
        width: 100%;
        background: white;
        border-collapse: collapse;
    }
    table, th, td {
        border: 1px solid #999;
    }
    th, td {
        padding: 8px;
        text-align: center;
    }
    .status-red { color: red; font-weight: bold; }
    .status-green { color: green; font-weight: bold; }
    .status-orange { color: orange; font-weight: bold; }
    button {
        margin-top: 10px;
        padding: 8px 15px;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }
    .delete-btn {
        background: #ff4d4d;
        color: white;
    }
    .export-btn {
        background: #007bff;
        color: white;
    }
</style>
</head>
<body>

<h2>ระบบบันทึกข้อมูลกำลังพล</h2>

<div class="form-box">
    <label>หมวด:</label>
    <select id="category">
        <option value="นายสิบ">นายสิบ</option>
        <option value="พลทหาร">พลทหาร</option>
        <option value="รายวัน">รายวัน</option>
    </select><br><br>

    <label>ชื่อ – สกุล:</label>
    <input type="text" id="name"><br><br>

    <label>จำนวนเงิน:</label>
    <input type="number" id="amount" placeholder="บาท"><br><br>

    <label>สถานะการจ่าย:</label>
    <select id="status">
        <option value="ยังไม่จ่าย">ยังไม่จ่าย</option>
        <option value="จ่ายแล้ว">จ่ายแล้ว</option>
        <option value="เซ็น">เซ็น</option>
    </select><br><br>

    <button onclick="addData()">บันทึกข้อมูล</button>
</div>

<h3>ตารางข้อมูล</h3>
<table id="dataTable">
    <thead>
        <tr>
            <th>หมวด</th>
            <th>ชื่อ</th>
            <th>จำนวนเงิน</th>
            <th>สถานะ</th>
            <th>เวลา</th>
            <th>ลบ</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<br>
<button class="export-btn" onclick="exportExcel()">ส่งออกเป็น Excel</button>

<script>
let dataList = JSON.parse(localStorage.getItem("records")) || [];

function saveLocal() {
    localStorage.setItem("records", JSON.stringify(dataList));
}

function loadTable() {
    const table = document.querySelector("#dataTable tbody");
    table.innerHTML = "";

    dataList.forEach((item, index) => {
        let statusClass = item.status === "ยังไม่จ่าย" ? "status-red"
                         : item.status === "จ่ายแล้ว" ? "status-green"
                         : "status-orange";

        table.innerHTML += `
            <tr>
                <td>${item.category}</td>
                <td>${item.name}</td>
                <td>${item.amount} บาท</td>
                <td class="${statusClass}">${item.status}</td>
                <td>${item.time}</td>
                <td><button class="delete-btn" onclick="deleteData(${index})">ลบ</button></td>
            </tr>
        `;
    });
}

function addData() {
    const category = document.getElementById("category").value;
    const name = document.getElementById("name").value.trim();
    const amount = document.getElementById("amount").value;
    const status = document.getElementById("status").value;

    if (name === "" || amount === "") {
        alert("กรุณากรอกชื่อ และจำนวนเงิน");
        return;
    }

    const now = new Date().toLocaleString("th-TH");

    dataList.push({ category, name, amount, status, time: now });
    saveLocal();
    loadTable();

    document.getElementById("name").value = "";
    document.getElementById("amount").value = "";
}

function deleteData(index) {
    dataList.splice(index, 1);
    saveLocal();
    loadTable();
}

function exportExcel() {
    let sheet = XLSX.utils.json_to_sheet(dataList);
    let wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, sheet, "Data");
    XLSX.writeFile(wb, "รายงานกำลังพล.xlsx");
}

loadTable();
</script>

</body>
</html>
